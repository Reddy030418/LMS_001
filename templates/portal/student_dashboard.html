{% extends 'base.html' %}
{% load static %}

{% block title %}Student Dashboard - ANU LMS{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h1>My Dashboard</h1>

    <!-- Fine Summary -->
    <div class="kpi-card">
        <h3>Total Fines</h3>
        <p>₹{{ fine_summary }}</p>
    </div>

    <!-- Currently Issued Books -->
    <div class="dashboard-card">
        <h2>Currently Issued Books</h2>
        {% if issued_books %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Book Title</th>
                        <th>Due Date</th>
                        <th>Fine (if overdue)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in issued_books %}
                        <tr>
                            <td>{{ transaction.book.title }}</td>
                            <td>{{ transaction.due_date }}</td>
                            <td>{% if transaction.fine_amount %}₹{{ transaction.fine_amount }}{% else %}-{% endif %}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No active issues.</p>
        {% endif %}
    </div>

    <!-- Borrowing History -->
    <div class="dashboard-card">
        <h2>Borrowing History</h2>
        {% if history %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Book Title</th>
                        <th>Issued On</th>
                        <th>Returned On</th>
                        <th>Fine</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in history %}
                        <tr>
                            <td>{{ transaction.book.title }}</td>
                            <td>{{ transaction.issued_on }}</td>
                            <td>{{ transaction.returned_on|default:"Not Returned" }}</td>
                            <td>{% if transaction.fine_amount %}₹{{ transaction.fine_amount }}{% else %}-{% endif %}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No borrowing history.</p>
        {% endif %}
    </div>

    <!-- Recommended Books -->
    <div class="dashboard-card">
        <h2>Recommended for You</h2>
        {% if recommendations %}
            <div class="book-grid">
                {% for book in recommendations %}
                    <div class="book-card">
                        <img src="{% static 'images/book-placeholder.png' %}" alt="{{ book.title }}" class="book-cover">
                        <h4>{{ book.title }}</h4>
                        <p>by {{ book.author }}</p>
                        <a href="{% url 'book_detail' book.id %}" class="btn">View Details</a>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No recommendations available.</p>
        {% endif %}
    </div>
</div>

<style>
.dashboard-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.kpi-card {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
    text-align: center;
    margin-bottom: 20px;
}

.kpi-card h3 {
    margin: 0 0 10px 0;
    font-size: 1.2em;
}

.kpi-card p {
    font-size: 2em;
    font-weight: bold;
    margin: 0;
}

.dashboard-card {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    padding: 20px;
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table th, .table td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}

.table th {
    background-color: #f2f2f2;
}

.book-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
}

.book-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    background: #fff;
}

.book-cover {
    width: 100px;
    height: 150px;
    object-fit: cover;
    margin-bottom: 10px;
}

.book-card h4 {
    font-size: 1em;
    margin: 10px 0;
}

.book-card p {
    color: #666;
    margin: 5px 0;
}

.btn {
    display: inline-block;
    padding: 8px 16px;
    background: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    margin-top: 10px;
}

.btn:hover {
    background: #0056b3;
}
</style>
{% endblock %}
